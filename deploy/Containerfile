FROM python:3.12-slim

LABEL maintainer="rgw-multisite-monitor"
LABEL description="Ceph RGW Multisite Sync Monitor"

WORKDIR /app

# Install radosgw-admin (required â€” this tool uses CLI exclusively)
# Adjust the Ceph release/repo for your version (e.g., reef, squid)
RUN apt-get update && apt-get install -y --no-install-recommends \
    curl gnupg2 lsb-release && \
    curl -fsSL https://download.ceph.com/keys/release.asc | apt-key add - && \
    echo "deb https://download.ceph.com/debian-reef/ $(lsb_release -cs) main" \
      > /etc/apt/sources.list.d/ceph.list && \
    apt-get update && apt-get install -y --no-install-recommends \
    ceph-common && \
    rm -rf /var/lib/apt/lists/*

# Python deps
COPY backend/requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy application
COPY backend/ .
COPY config.yaml .

# Mount /etc/ceph from host for cluster access
VOLUME ["/etc/ceph"]

EXPOSE 5000

CMD ["python", "api_server.py"]